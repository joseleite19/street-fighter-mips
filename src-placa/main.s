	#music_delays:	.space 1600
	#music_notes:	.space 400
	#music_lens:	.space 1600
.data
	music_delays:	.word 576, 192,  96, 192,  96, 768, 192, 192,  96, 192,  96, 768, 192,  96, 192, 192, 192, 192,  96, 192, 192, 192, 192,  96, 192,  96, 768, 192, 192,  96, 192,  96, 768, 192,  96, 192, 192, 192, 192,  96, 192, 192, 192, 960, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 480, 384, 960, 192,  96, 288, 384, 192, 384, 192,  96, 288, 960, 192,  96, 288, 384, 384, 384, 384, 960, 192, 192, 192, 960, 192,  96, 288,2688, 192, 192, 960, 192,  96, 288, 384, 384, 384, 384, 384,2304, 192, 192, 960, 192,  96, 192, 384, 288, 384, 192,  96, 288, 384, 288, 288, 192,  96, 192, 672,  96,  96, 384, 192, 192, 960, 192, 192,1152, 192,  96, 288,  96,  96,  88,2408, 192, 192, 960, 192,  96, 192, 384, 288, 384, 192, 192, 192,  96, 184,2792, 192,  96, 192,  96, 768, 192, 192,  96, 192,  96, 768, 192,  96, 192, 192, 192, 192,  96, 192, 192, 192, 192,  96, 192,  96, 768, 192, 192,  96, 192,  96, 768, 192,  96, 192, 192, 192, 192,  96, 192, 192, 192, 960, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 480, 384, 960, 192,  96, 288, 384, 192, 384, 192,  96, 288, 960, 192,  96, 288, 384, 384, 384, 384, 960, 192, 192, 192, 960, 192,  96, 288,2688, 192, 192, 960, 192,  96, 288, 384, 384, 384, 384, 384,2304, 192, 192, 960, 192,  96, 192, 384, 288, 384, 192,  96, 288, 384, 288, 288, 192,  96, 192, 672,  96,  96, 384, 192, 192, 960, 192, 192,1152, 192,  96, 288,  96,  96,  88,2408, 192, 192, 960, 192,  96, 192, 384, 288, 384, 192, 192, 192,  96, 184,3000
	music_notes:	.byte  74,  75,  75,  74,  74,  75,  74,  75,  75,  74,  74,  75,  74,  75,  74,  75,  74,  77,  77,  75,  74,  70,  75,  75,  74,  74,  75,  74,  75,  75,  74,  74,  75,  74,  75,  74,  75,  74,  77,  77,  75,  74,  70,  60,  62,  63,  65,  67,  65,  70,  68,  67,  68,  62,  63,  65,  58,  62,  65,  68,  70,  67,  62,  60,  62,  63,  65,  67,  65,  65,  65,  67,  68,  70,  72,  74,  75,  79,  77,  74,  70,  72,  74,  75,  77,  72,  74,  75,  77,  79,  70,  70,  80,  79,  77,  79,  77,  75,  74,  70,  72,  67,  70,  70,  72,  74,  75,  77,  79,  80,  77,  74,  72,  74,  74,  75,  77,  70,  74,  77,  80,  79,  77,  79,  77,  75,  72,  74,  75,  77,  79,  75,  74,  72,  74,  75,  72,  70,  70,  72,  74,  75,  77,  79,  72,  82,  80,  79,  77,  74,  75,  72,  75,  75,  74,  74,  75,  74,  75,  75,  74,  74,  75,  74,  75,  74,  75,  74,  77,  77,  75,  74,  70,  75,  75,  74,  74,  75,  74,  75,  75,  74,  74,  75,  74,  75,  74,  75,  74,  77,  77,  75,  74,  70,  60,  62,  63,  65,  67,  65,  70,  68,  67,  68,  62,  63,  65,  58,  62,  65,  68,  70,  67,  62,  60,  62,  63,  65,  67,  65,  65,  65,  67,  68,  70,  72,  74,  75,  79,  77,  74,  70,  72,  74,  75,  77,  72,  74,  75,  77,  79,  70,  70,  80,  79,  77,  79,  77,  75,  74,  70,  72,  67,  70,  70,  72,  74,  75,  77,  79,  80,  77,  74,  72,  74,  74,  75,  77,  70,  74,  77,  80,  79,  77,  79,  77,  75,  72,  74,  75,  77,  79,  75,  74,  72,  74,  75,  72,  70,  70,  72,  74,  75,  77,  79,  72,  82,  80,  79,  77,  74,  75,  72
	music_lens:		.word 576,  96,  96,  96,  96, 768, 192,  96,  96,  96,  96, 768, 192,  96,  96, 192,  96,  96,  96,  96, 192, 192,  96,  96,  96,  96, 768, 192,  96,  96,  96,  96, 768, 192,  96,  96, 192,  96,  96,  96,  96, 192, 192, 960, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 192, 192,  96, 288, 384, 288, 480, 384, 960, 192,  96, 288, 384, 192, 384, 192,  96, 288, 768, 192,  96, 288, 384, 384, 384, 384, 960, 192, 192, 192, 960,  96,  96, 288,2688,  96, 192, 960,  96,  96, 288, 384, 384, 384, 384, 384,2304,  96, 192, 960, 192,  96, 192, 384, 192, 384, 192,  96, 288, 384, 288, 192, 192,  96, 192, 672,  96,  96, 384, 192, 192, 960, 192, 192,1152, 192,  96, 288,  96,  96,  96,2400, 192, 192, 960, 192,  96, 192, 384, 192, 384, 192, 192,  96,  96,  96,2688,  96,  96,  96,  96, 768, 192,  96,  96,  96,  96, 768, 192,  96,  96, 192,  96,  96,  96,  96, 192, 192,  96,  96,  96,  96, 768, 192,  96,  96,  96,  96, 768, 192,  96,  96, 192,  96,  96,  96,  96, 192, 192, 960, 192,  96, 288, 384, 288, 288, 192,  96, 288, 384, 288, 192, 192,  96, 288, 384, 288, 480, 384, 960, 192,  96, 288, 384, 192, 384, 192,  96, 288, 768, 192,  96, 288, 384, 384, 384, 384, 960, 192, 192, 192, 960,  96,  96, 288,2688,  96, 192, 960,  96,  96, 288, 384, 384, 384, 384, 384,2304,  96, 192, 960, 192,  96, 192, 384, 192, 384, 192,  96, 288, 384, 288, 192, 192,  96, 192, 672,  96,  96, 384, 192, 192, 960, 192, 192,1152, 192,  96, 288,  96,  96,  96,2400, 192, 192, 960, 192,  96, 192, 384, 192, 384, 192, 192,  96,  96,  96,2688

	music_nxt_t:	.word 0
	music_nxt_ind:	.half 0
	music_sz:		.half 303




.text
.macro get_time(%reg)
	li $v0, 30
	syscall
	nop
	nop
	add %reg, $zero, $a0
.end_macro
main:
	jal music_init
	nop
	nop
	nop

	j screen_menu
	nop
	nop

.include "common.s"
.include "screens/menu.s"
.include "screens/arcade.s"


end:    _syscall(10)

.macro w_set_val(%adr, %ind, %val)
	la $a0, %adr
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	sw %val, 0($a0)
.end_macro

.macro h_set_val(%adr, %ind, %val)
	la $a0, %adr
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	sh %val, 0($a0)
.end_macro
.macro bu_get_val(%adr, %ind, %reg)
	la $a0, %adr
	add $a0, $a0, %ind
	lbu %reg, 0($a0)
.end_macro

.macro w_get_val(%adr, %ind, %reg)
	la $a0, %adr
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	lw %reg, 0($a0)
.end_macro

.macro hu_get_val(%adr, %ind, %reg)
	la $a0, %adr
	add $a0, $a0, %ind
	add $a0, $a0, %ind
	lhu %reg, 0($a0)
.end_macro


music_init:
		get_time($t0)
		add $t0, $t0,  500
		add $t1, $zero,  0

		w_set_val(music_nxt_t,		0,	$t0)
		h_set_val(music_nxt_ind,	0,	$t1)

		jr $ra
	music_play:
		get_time($t0)

		w_get_val(music_nxt_t,		0,	$t1)
		blt $t0, $t1, music_jr_ra
		hu_get_val(music_nxt_ind,	0,	$t2)
		w_get_val(music_delays,		$t2,$t3)
		bu_get_val(music_notes,		$t2,$t4)
		#bu_get_val(music_vols,		$t2,$t5)
		w_get_val(music_lens,		$t2,$t6)
		hu_get_val(music_sz, 		0,	$t7)

		multi($t3, $t3, 7)
		addi $at, $zero, 5
		div $t3, $at
		mflo $t3

		multi($t6, $t6, 7)
		addi $at, $zero, 5
		div $t6, $at
		mflo $t6

		#print_int($t0)
		#print_int($t1)
		#print_int($t2)
		#print_int($t3)
		#print_int($t4)
		#print_int($t5)
		#print_int($t6)
		#print_int($t7)

		midi($t4,$t6,24,250)

		#max($t3, 10)
		add $t1, $t1, $t0
		div $t1, $t1, 2
		add $t1, $t1, $t3
		w_set_val(music_nxt_t,		0,	$t1)

		add $t2, $t2, 1
		mod($t2, $t2, $t7)
		h_set_val(music_nxt_ind,	0,	$t2)


		#j music_play

	music_jr_ra: jr $ra